(()=>{"use strict";class e{static error={default:"An error has occurred",BAD_RESULT:{container:{type:"warn",eval:'Your "eval" container expression return more than one result'}},BAD_VALUE:{default:e=>"Some values are wrong in your "+e.identifier+" "+e.type,association:e=>"Some values are incompatible in your "+e.identifier+" "+e.name},BAD_TYPE:e=>"The type "+e.type+' "'+e.value+'" is not allowed in this declaration',NOT_FOUND:{variable:e=>"No variable found with the name "+e.value},NO_DECLARATION:e=>'You must specify a declaration after "'+e.value+'" statement',NO_CONDITION:e=>'You must specify a condition after "'+e.value+'" statement',NO_STATEMENT:e=>'Statement "'+e.value+'" must be preceded by an "if" or "elseif" statement',NO_PRESET:e=>"No preset found with the name "+e.value,NO_KEYWORD:{import:'Keyword "from" is missing in you import declaration'},NO_CLOSURE:{default:e=>"You must close every "+e.type,delimiter:e=>"You must close every "+e.identifier+" container"},NO_IMPORT:{import:e=>'No export found with the name "'+e.value+'"',reference:e=>'No import found with the name "'+e.value+'"'},NO_BOUNDS:e=>"Argument missing in "+e.identifier+" "+e.type,NO_NAME:e=>"You must specify a name for "+e.type+" "+e.identifier,NO_FILE:e=>"No file found for this "+e.type+" "+e.identifier,EMPTY:e=>"Your "+e.type+" "+e.identifier+" is empty",NaN:{association:e=>"Second argument must be a number after "+e.identifier+" "+e.name}}}class t{static behavior="default";static code=[];static path={};static export={};static import={};static variable={}}class i{constructor(i,s="default"){this.token=i,this.errorCode=s,this.parent=e.error[s]?e.error[s][i.type]?e.error[s][i.type]:e.error[s]:e.error.default,this.errorType=this.parent.type||"error",this.message=this.parent[i.identifier]||this.parent.default||this.parent;let r=this.token.uuid;this.sourceCode=t.code[r],this.path=t.path[r],this.log()}log(){if("highlight"===t.behavior)return;let e=this.token.trace.start,i=this.token.trace.end,s=e.char-e.col,r=this.getLines(3,s),n=this.sourceCode.substring(s,r),a="("+this.errorCode+") ["+this.token.type+(this.token.identifier?", "+this.token.identifier:"")+"] - ";a+=("function"==typeof this.message?this.message(this.token):this.message)+"\n\n",a+="*----\n"+n+"\n----*\n\n",a+=this.path?"from: "+this.path+"\n\n":"",a+="start ("+Object.entries(e).map((e=>e.join(": "))).join(", ")+")\n",a+="  end ("+Object.entries(i).map((e=>e.join(": "))).join(", ")+")\n",this.displayError(a)}displayError(e){let i="",s="";if("cli"===t.behavior&&(s="warn"===this.errorType?"[33m":"[31m",i="[0m"),"warn"!==this.errorType)throw console.error(s+e+i),"fatal error";console.warn(s+e+i)}getLines(e,t){let i=t,s=0;for(var r=t;r<this.sourceCode.length&&("\n"===this.sourceCode[r]&&s++,!(s>e));r++,i++);return i}}class s{constructor(){this.start={char:0,col:0,line:0},this.end={char:0,col:0,line:0}}startFrom(e){return e&&(Object.assign(this.start,e.end),this.endBy(e)),this}startBy(e){return e&&Object.assign(this.start,e.start),this}endBy(e){return e&&Object.assign(this.end,e.end),this}bounds(e,t){return this.startBy(e),this.endBy(t||e),this}addChar(e){this.end.char+=e||1}addCol(e){this.end.col+=e||1}push(e){this.addChar(e),this.addCol(e)}addLine(e){this.end.line+=e||1}setCol(e){this.end.col=e||0}break(){this.addLine(),this.setCol()}}class r{constructor(e){this.i=0,this.list=e||[],this.uuid=this.list.uuid,this.source=this.list,this.output=this.list}main(){}while(e,t){let i=this.list;for(this.i;this.i<i.length;this.i++){let s=this.i;if(!e(i[s],s))break;t(i[s],s)}}run(e){return e&&this.trace.startFrom(e),this.while((()=>!0),((e,t)=>{e.deep&&(e.childs=new this.constructor(e.childs).run().output),this.main(e,t)})),this}next(e,t=!1){this.i+=e||1;let i=this.list[this.i]||!1;if(!i)return!1;if(t){let e=[i];e.uuid=i.uuid,i=new this.constructor(e).run().output[0]}return i.deep&&(i.childs=new this.constructor(i.childs).run().output),i}before(e){return this.source[this.i-(e||1)]||!1}after(e){return this.source[this.i+(e||1)]||!1}length(e){return this.source.length-(e||1)}end(){return this.i===this.length()}closure(e,t){return e&&this.end()&&(this.trace&&t.trace.endBy(this.trace),new i(t,"NO_CLOSURE")),e}}class n extends r{constructor(e=""){super(),this.code=e,this.source=this.code,this.output=[],this.output.uuid=this.uuid,this.trace=new s}while(e,t,i=0,s=0){let r=this.code,n=0,a=!0,o=!1,h=!1;for(this.i;this.i<r.length;this.i++,n++){let u=n<i,l=this.i;if(!e(r[l],l)&&!u&&!h){this.i--,s&&this.while((()=>s>=0),(()=>s--));break}a||this.trace.push(),o&&(this.trace.break(),o=!1),"\n"===r[l]&&(o=!0),"\\"!==r[l]||h?(t&&!u&&t(r[l],h),h=!1,a=!1):(h=!0,a=!1)}}}class a{constructor(e=0){this.uuid=e,this.type="any",this.identifier=!1,this.name=!1,this.attributes={},this.classList=[],this.status=!1,this.count=1,this.childs=[],this.childs.uuid=this.uuid,this.deep=!1,this.trace=new s,this.value=""}set(e){for(let t in e)this[t]=e[t];return this}childsTrace(){this.childs.length&&this.trace.bounds(this.childs[0].trace,this.childs[this.childs.length-1].trace)}deepClone(){let e=new a(this.uuid);return["type","identifier","name","status","count","deep","trace","value"].forEach((t=>e[t]=this[t])),this.childs.forEach((t=>{e.childs.push(t.deepClone())})),e}}class o extends n{constructor(e,i=""){super(e),this.uuid=this.output.uuid="highlight"!==t.behavior?t.code.push(this.code)-1:0,this.commentsEnabled=!1,t.path[this.uuid]=i}comments(e){return this.commentsEnabled=e,this}main(e,t){const s=/[a-z]/i,r=/\d/,n=/[\w\d-]/,o=/[a-z-]/i;let h=new a(this.uuid);h.trace.startFrom(this.trace);let u=!1;if(!t&&!/\s/.test(e)){if(s.test(e))h.type="word",this.while((e=>n.test(e)||":"===e),(e=>{h.value+=e})),"is"!==h.value&&"from"!==h.value||(h.identifier="keyword"),"is"===h.value&&(h.type="assignment");else if("!"===e&&s.test(this.after()))h.type="word",h.identifier="schema",h.value="!",this.while((e=>"\n"!==e&&"!"!==e),(e=>{h.value+=e}),1);else if(r.test(e))h.type="number",this.while((e=>r.test(e)),(e=>{h.value+=e})),h.value=Number(h.value);else if(!/(\$|@|#|&|\.)/.test(e)||"&"===e&&"&"===this.after())if("'"===e||'"'===e)h.type="string",h.identifier='"'===e?"double":"single",this.while((t=>this.closure(t!==e,h)),(e=>{h.value+=e}),1,1);else if("/"===e&&"/"===this.after()){if(h.type="comment",h.identifier="inline",this.while((e=>"\n"!==e),(e=>{h.value+=e}),2),!this.commentsEnabled)return}else if("/"===e&&"*"===this.after()){if(h.type="comment",h.identifier="block",this.while((e=>"*"!==e||"/"!==this.after()),(e=>{h.value+=e}),2,2),!this.commentsEnabled)return}else"="===e&&"="===this.after()?(u=!0,h.type="comparator",h.identifier="equality"):"!"===e&&"="===this.after()?(u=!0,h.type="comparator",h.identifier="difference"):">"===e&&">"===this.after()?(u=!0,h.type="comparator",h.identifier="superior"):"<"===e&&"<"===this.after()?(u=!0,h.type="comparator",h.identifier="inferior"):"&"===e&&"&"===this.after()?(u=!0,h.type="choice",h.identifier="and"):"|"===e&&"|"===this.after()?(u=!0,h.type="choice",h.identifier="or"):"="===e?h.type="assignment":"+"===e?(h.type="operator",h.identifier="add"):"-"===e?(h.type="operator",h.identifier="substract"):"*"===e?(h.type="operator",h.identifier="multiply"):"/"===e?(h.type="operator",h.identifier="divide"):"%"===e?(h.type="operator",h.identifier="modulo"):">"===e?(h.type="symbol",h.identifier="parent"):"<"===e?(h.type="symbol",h.identifier="child"):","===e?(h.type="symbol",h.identifier="brother"):"?"===e?(h.type="symbol",h.identifier="question"):"!"===e?(h.type="symbol",h.identifier="exclamation"):"["===e?(h.type="delimiter",h.identifier="attribute",h.status="open"):"]"===e?(h.type="delimiter",h.identifier="attribute",h.status="close"):"{"===e?(h.type="delimiter",h.identifier="group",h.status="open"):"}"===e?(h.type="delimiter",h.identifier="group",h.status="close"):"("===e?(h.type="delimiter",h.identifier="eval",h.status="open"):")"===e&&(h.type="delimiter",h.identifier="eval",h.status="close"),h.value+=e,u&&(this.trace.push(),h.value+=this.after(),this.i++);else{const t="$"===e?"variable":"@"===e?"rule":"&"===e?"reference":"#"===e?"id":"."===e?"class":null;h.type=t,h.identifier="declaration",this.while((e=>o.test(e)),(e=>{h.value+=e}),1),h.value.length<1&&new i(h,"NO_NAME"),"rule"!==t||"true"!==h.value&&"false"!==h.value||h.set({type:"boolean",identifier:!1,value:"true"===h.value})}h.trace.endBy(this.trace),this.output.push(h)}}}class h extends r{constructor(e){super(e)}main(e){if("delimiter"!==e.type||"open"!==e.status)return!0;let t=new a(this.uuid).set({type:"container",identifier:e.identifier,deep:!0}),i=this.i++;this.while((t=>this.closure("delimiter"!==t.type||"close"!==t.status||t.identifier!==e.identifier,e)),(e=>{this.main(e)&&t.childs.push(e)})),t.trace.bounds(this.output[i].trace,this.output[this.i].trace),this.output.splice(i,this.i-i+1,t),this.i=i-1}}class u extends r{constructor(e){super(e)}condition(e){return!0}main(e){if(!this.condition(e))return;this.after()&&this.before()||new i(e,"NO_BOUNDS");let t=this.i,s=new a(this.uuid).set({type:"association",name:e.type,identifier:e.identifier,deep:!0});s.childs.push(this.before(),this.after()),s.trace.bounds(e.trace),this.output.splice(t-1,3,s),this.i=t-2}}class l extends u{constructor(e){super(e)}condition(e){return"assignment"===e.type&&this.before()&&"variable"===this.before().type&&(e.identifier="variable",this.before().identifier="assignment"),"assignment"===e.type}}let d=require("vscode");const c=["declaration","keyword","schema","double","single","equality","difference","superior","inferior","and","or","add","substract","multiply","devide","modulo","inline","block","parent","brother","question","exclamation","attribute","group","eval"],p=new d.SemanticTokensLegend(["word","number","string","variable","rule","reference","id","class","boolean","comparator","choice","assignment","operator","symbol","delimiter","attribute_key","attribute_value","comment","container","group"],c),f={provideDocumentSemanticTokens(e){const t=new d.SemanticTokensBuilder(p);return function(e,t){i.mode="highlight";let s=new o(e).comments(!0).run().output,r=new o(e).run().output,n=new h(r).run().output;(function e(i,s){i.forEach((i=>{"container"===i.type?e(i.childs,"attribute"===i.identifier):s&&("word"===i.type?(i.type="attribute_key",m(i,t)):"association"===i.type&&"assignment"===i.name&&(i.childs[0].type="attribute_key","word"===i.childs[1].type&&(i.childs[1].type="attribute_value"),m(i.childs[0],t),m(i.childs[1],t)))}))})(new l(n).run().output),s.forEach((e=>{m(e,t)}))}(e.getText(),t),t.build()}};function m(e,t){let i=e.trace.start,s=e.trace.end,r=i.col+(s.char+1-i.char),n=s.line-i.line+1;for(let a=0;a<n;a++)t.push(new d.Range(new d.Position(i.line+a,a?0:i.col),new d.Position(i.line+a,a===n-1?s.col+1:r)),e.type,y(e))}function y(e){return e.identifier?c.indexOf(e.identifier)+1===0?[]:[e.identifier]:[]}d.languages.registerDocumentSemanticTokensProvider({language:"sdom",scheme:"file"},f,p)})();